<html>
<!-- Based on https://www.puzzleplayground.com/jumping_clones -->

<head>
  <title>Jumping Clones</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    /* A lot of the code ported from https://eloquentjavascript.net/ */
    *{box-sizing:border-box}.wrapper,body{background:#000}.wrapper{position:relative;font-family:sans-serif;--wall-border-width:2px}.game{overflow:hidden;position:absolute}.level-text{color:#000;position:absolute;z-index:999;font-weight:700}.menu{position:absolute;overflow-y:auto;top:50%;left:50%;transform:translate(-50%,-50%)}.levels-wrapper{padding:0;margin-bottom:-6px}.menu-text{z-index:999;transform:translateY(-25%)}.menu-item,.menu-text{color:#000;position:absolute}.menu-item{box-sizing:content-box;background-color:#35a6ca;border-style:solid;border-color:transparent;border-radius:25%;text-align:center;font-weight:700;line-height:1.5em}.menu-item.selected{border-style:dashed;border-color:#fff}.menu-item[data-status="0"]{color:transparent;background-color:#ca3535}.menu-item[data-status="0"]:after{position:absolute;top:0;left:0;width:100%;height:100%;color:#000;content:"ðŸ”’"}.menu-item[data-status="1"]{background-color:#cac135}.menu-item[data-status="2"]{background-color:#35a6ca}.end{color:#fff;z-index:9999;text-align:center}.end,.explode-wrapper{position:absolute;top:0;left:0}.explode-wrapper{background:transparent}.explode-dot{border-radius:50%;background:#fff;position:absolute}.fade-overlay{z-index:999999;background:#000;position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none}.background{background:#888;table-layout:fixed;border-spacing:0}.empty[data-number="0"]{background:#080820}.empty[data-number="1"]{background:#10102c}.wall{position:relative;background:#b9852a}.wall:before{left:50%;width:20%;background:#a5792b;transform:translateX(-50%)}.wall:after,.wall:before{position:absolute;content:"";top:0;height:100%}.wall:after{box-sizing:border-box;left:0;width:100%;border:0 solid #e7c181}.wall.top:after{border-top-width:var(--wall-border-width)}.wall.bottom:after{border-bottom-width:var(--wall-border-width)}.wall.left:after{border-left-width:var(--wall-border-width)}.wall.right:after{border-right-width:var(--wall-border-width)}.lava{background:#f44}.actor{position:absolute}.locked .portal[class~=Infinity]{--b:#055;--c:#022}.portal[class~=Infinity]{--b:#0ff;--c:#0bb}.portal[class~="1"]{--b:red;--c:#b00}.portal{padding:0;background-color:var(--b)}.portal:after{content:"";display:block;position:relative;top:-20%;left:-20%;width:calc(var(--w)/5);height:calc(var(--w)/5);background-color:transparent;
        box-shadow:calc(var(--w)*0.56) calc(var(--w)*0.56) var(--b),calc(var(--w)*0.56) calc(var(--w)*0.6) var(--b),calc(var(--w)*0.56) calc(var(--w)*0.64) var(--b),calc(var(--w)*0.6) calc(var(--w)*0.56) var(--b),calc(var(--w)*0.6) calc(var(--w)*0.64) var(--b),calc(var(--w)*0.64) calc(var(--w)*0.56) var(--b),calc(var(--w)*0.64) calc(var(--w)*0.6) var(--b),calc(var(--w)*0.64) calc(var(--w)*0.64) var(--b),calc(var(--w)*0.5) calc(var(--w)*0.5) var(--c),calc(var(--w)*0.5) calc(var(--w)*0.6) var(--c),calc(var(--w)*0.5) calc(var(--w)*0.7) var(--c),calc(var(--w)*0.6) calc(var(--w)*0.5) var(--c),calc(var(--w)*0.6) calc(var(--w)*0.7) var(--c),calc(var(--w)*0.7) calc(var(--w)*0.5) var(--c),calc(var(--w)*0.7) calc(var(--w)*0.6) var(--c),calc(var(--w)*0.7) calc(var(--w)*0.7) var(--c),calc(var(--w)*0.38) calc(var(--w)*0.38) var(--b),calc(var(--w)*0.38) calc(var(--w)*0.49) var(--b),calc(var(--w)*0.38) calc(var(--w)*0.6) var(--b),calc(var(--w)*0.38) calc(var(--w)*0.71) var(--b),calc(var(--w)*0.38) calc(var(--w)*0.82) var(--b),calc(var(--w)*0.49) calc(var(--w)*0.38) var(--b),calc(var(--w)*0.49) calc(var(--w)*0.82) var(--b),calc(var(--w)*0.6) calc(var(--w)*0.38) var(--b),calc(var(--w)*0.6) calc(var(--w)*0.82) var(--b),calc(var(--w)*0.71) calc(var(--w)*0.38) var(--b),calc(var(--w)*0.71) calc(var(--w)*0.82) var(--b),calc(var(--w)*0.82) calc(var(--w)*0.38) var(--b),calc(var(--w)*0.82) calc(var(--w)*0.49) var(--b),calc(var(--w)*0.82) calc(var(--w)*0.6) var(--b),calc(var(--w)*0.82) calc(var(--w)*0.71) var(--b),calc(var(--w)*0.82) calc(var(--w)*0.82) var(--b),calc(var(--w)*0.32) calc(var(--w)*0.32) var(--c),calc(var(--w)*0.32) calc(var(--w)*0.46) var(--c),calc(var(--w)*0.32) calc(var(--w)*0.6) var(--c),calc(var(--w)*0.32) calc(var(--w)*0.74) var(--c),calc(var(--w)*0.32) calc(var(--w)*0.88) var(--c),calc(var(--w)*0.46) calc(var(--w)*0.32) var(--c),calc(var(--w)*0.46) calc(var(--w)*0.88) var(--c),calc(var(--w)*0.6) calc(var(--w)*0.32) var(--c),calc(var(--w)*0.6) calc(var(--w)*0.88) var(--c),calc(var(--w)*0.74) calc(var(--w)*0.32) var(--c),calc(var(--w)*0.74) calc(var(--w)*0.88) var(--c),calc(var(--w)*0.88) calc(var(--w)*0.32) var(--c),calc(var(--w)*0.88) calc(var(--w)*0.46) var(--c),calc(var(--w)*0.88) calc(var(--w)*0.6) var(--c),calc(var(--w)*0.88) calc(var(--w)*0.74) var(--c),calc(var(--w)*0.88) calc(var(--w)*0.88) var(--c)}.teleporter{background:#fff}.teleporter[class~="0"]{background:#db02fa}.teleporter[class~="1"]{background:#02a1fa}.teleporter[class~="2"]{background:#11ff32}.teleporter[class~="3"]{background:#fff511}.teleporter[class~="4"]{background:#3b5aff}.teleporter[class~="5"]{background:#ff00cb}.teleporter[class~="6"]{background:#fa3c06}.teleporter[class~="7"]{background:#02fadc}.teleporter[class~="8"]{background:#9ecc2e}.teleporter[class~="9"]{background:#dcdcdc}.key{background:#488a93}.key.flash{background:#84c6cf}
    .trampoline{background-color:#c8c8c8;border:1px solid #484848;border-radius:15%;background-size:contain;background-repeat:no-repeat;background-image:url("data:image/svg+xml,%3Csvg%20width='100'%20height='100'%20xmlns='http://www.w3.org/2000/svg'%3E%3Cpolygon%20points='50,10%2010,50%2090,50'%20fill='black'/%3E%3Crect%20x='40'%20y='40'%20width='20'%20height='50'%20fill='black'/%3E%3C/svg%3E")}.trampoline.bounce{background-color:#fff;transform:translateY(15%) scaleY(.75)}.player{z-index:10;border-radius:12%;border:0 solid transparent}.player.n{background:#f2f2f2}.player.u{background:#843fd7}.player.y{background:#cdcb32}.player.g{background:#5ccd32}.player.r{background:#cd3232}.player.s{background:#005a9e}.player.w{background:#848484}.player:after{border-radius:50%;width:40%;height:40%;background:#000;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);content:""}.player.down:after{transform:translate(-50%)}.player.up:after{transform:translate(-50%,-100%)}.player.left:after{transform:translate(-100%,-50%)}.player.right:after{transform:translateY(-50%)}.player.left.down:after{transform:translate(-100%)}.player.left.up:after{transform:translate(-100%,-100%)}.player.right.down:after{transform:translate(0)}.player.right.up:after{transform:translateY(-100%)}.lost .player:after{display:none}.spike{background-size:contain;background-repeat:no-repeat}.spike.up{background-image:url("data:image/svg+xml,%3Csvg%20width='100'%20height='50'%20xmlns='http://www.w3.org/2000/svg'%3E%3Cpolygon%20points='25,0%200,50%2050,50'%20fill='white'/%3E%3Cpolygon%20points='75,0%2050,50%20100,50'%20fill='white'/%3E%3C/svg%3E")}.spike.down{background-image:url("data:image/svg+xml,%3Csvg%20width='100'%20height='50'%20xmlns='http://www.w3.org/2000/svg'%3E%3Cpolygon%20points='25,50%200,0%2050,0'%20fill='white'/%3E%3Cpolygon%20points='75,50%2050,0%20100,0'%20fill='white'/%3E%3C/svg%3E")}.spike.left{background-image:url("data:image/svg+xml,%3Csvg%20width='50'%20height='100'%20xmlns='http://www.w3.org/2000/svg'%3E%3Cpolygon%20points='0,25%2050,0%2050,50'%20fill='white'/%3E%3Cpolygon%20points='0,75%2050,50%2050,100'%20fill='white'/%3E%3C/svg%3E")}.spike.right{background-image:url("data:image/svg+xml,%3Csvg%20width='50'%20height='100'%20xmlns='http://www.w3.org/2000/svg'%3E%3Cpolygon%20points='50,25%200,0%200,50'%20fill='white'/%3E%3Cpolygon%20points='50,75%200,50%200,100'%20fill='white'/%3E%3C/svg%3E")}
  </style>
</head>

<body>
  <button onclick="
    this.remove();
    /* A lot of the code ported from https://eloquentjavascript.net/16_game.html then modified */
    const GAME_LEVELS = [`########################\n####................####\n###..................###\n##....................##\n#......................#\n#......................#\n#......................#\n#..........@...........#\n#......................#\n#..........##..........#\n#..........##..........#\n#..........##..........#\n#....##############....#\n#....#.....##.....#....#\n#.n..#.....##.....#..n.#\n########################\n########################`,`########################\n#####................###\n###..................@.#\n#......................#\n#......................#\n#......................#\n#.n....................#\n##############^^^^######\n#####........######..###\n###...........####...@.#\n#......................#\n#......................#\n#......................#\n#.n....................#\n######....##############\n######....##############\n######....##############`,`########################\n#..........#.#.#.......#\n#.....@................#\n#......................#\n#.....##...............#\n#......................#\n###................#####\n#................n.#####\n###########^^^^^########\n#@........#######......#\n#......................#\n###....................#\n#......................#\n#....###...............#\n#....................n.#\n###########.....########\n###########.....########`,`########################\n###.###..............!.#\n##...##................#\n#.....#..............###\n##...##......##..##....#\n###.###................#\n##########.............#\n#.......!..............#\n#.n.n.n................#\n############...#######.#\n#####..#####...#.....#.#\n###......###...#.....#.#\n#..........#...#..#..###\n###......###......#..!.#\n#####..#####......#....#\n########################\n########################`,`########################\n#####...............##.#\n####.........n....@.#..#\n###..........n......##.#\n##.........#############\n#...................####\n#......##............###\n#.....................##\n#......................#\n#......#####...........#\n#......#.#.#...........#\n#......#.#.#...........#\n#......#####...........#\n#......#!.........###..#\n#......#......n.n......#\n#......#################\n#......#################`,`########################\n#>.........@..........<#\n#>....................<#\n#>.....##########.....<#\n#>....................<#\n#>.##..............##.<#\n#>....................<#\n#>.....##......##.....<#\n#>....................<#\n#>.........##.........<#\n#>....................<#\n#>....................<#\n###########..###########\n#......................#\n#..n................r..#\n########################\n########################`,
        `########################\n##..##@...........##..##\n#....#............#....#\n#....###..........#....#\n#.##.#............#.##.#\n#.#..#............#..#.#\n#.#..#...##.......#..#.#\n#.#..#............#..#.#\n#.#..#............#..#.#\n#.#..#......###...#..#.#\n#.#..#.......#....#..#.#\n#.##.#.......#^^^^#.##.#\n#....#.......######....#\n#....#.......#..!.#....#\n##..###.n.r.......##..##\n########################\n########################`,`########################\n#..#####........#####..#\n#..####....@.....####..#\n#..###............###..#\n######............###..#\n#!.###............###..#\n#..###............######\n#..#.#............#.#!.#\n#..###............###..#\n#......................#\n#......................#\n#...#..............#####\n#...#..n........n..#...#\n#...#..#........#..#.#.#\n#####......N.......#...#\n########################\n########################`,`########################\n#..@..............#....#\n#.................##...#\n#..................##..#\n#.g.................##.#\n#######..............###\n#.#.#.###..............#\n#.#.#.#......###.......#\n#.#.#.########.........#\n#.#.#............#.....#\n#.#....................#\n#......................#\n#..................##..#\n#....................!.#\n#.....n.#...#...#......#\n########################\n########################`,`########################\n#.###.##...##...##...@.#\n#..#..#....#....#......#\n#.....#....#....#......#\n#.....#g...#....#......#\n#.....#g...#g...#......#\n#.....##...##...##.....#\n#..n...................#\n#######..###..###..##..#\n#...#.#..#.#..#.#..#...#\n#.#.#!...#!...#!...#...#\n#...#....#....#....#^^^#\n########################\n#...#....#....#....#...#\n#......................#\n########################\n########################`,`########################\n####.................@.#\n###....................#\n##........#............#\n#.........#............#\n#.......=.#..........=.#\n#.........#............#\n#.........#............#\n#......=..#........=...#\n#.........#............#\n#.........#............#\n#.g...=...#......=.....#\n####......#............#\n#.........#............#\n#^^^^=^^^^#^^^^=^^^^^^^#\n########################\n########################`,`########################\n#@....#................#\n#.....#................#\n####..#...#............#\n####......#............#\n#!........#............#\n#...n.....#.=....##....#\n###########....=.......#\n#.......#..............#\n#.......#.............=#\n#.......#.g............#\n#.......####.....##....#\n#...................=..#\n#............=.........#\n#^^^^^^^^^^^^^^^^^^^^^^#\n########################\n########################`,
        `########################\n#.#.#.....#...#...#....#\n#####................@.#\n#......................#\n#....................###\n#......................#\n#.r....................#\n#######^^^#^^^#^^^#^^^^#\n########################\n#......................#\n#@.....................#\n#....................g.#\n####...............#####\n###..................###\n##....................##\n#....=...=...=...=.....#\n#......................#`,`########################\n#....................@.#\n#......................#\n#....................###\n#.....................##\n#......................#\n#.y.............##.....#\n######^^^^##^^^^##^^^^^#\n#...####################\n#.#.##########@........#\n#...##########.........#\n#####vvvvvvvv###.......#\n#......................#\n#......................#\n#.n...............##^^^#\n########################\n########################`,`########################\n###.#######@.#######.###\n###.###vvvv..vvvv###.###\n###.###..........###.###\n##...##.n........##...##\n##.#.##############.#.##\n##.#.######@.######.#.##\n#..#..#vvvv..vvvv#..#..#\n#..#..#..........#..#..#\n##.#.##.r........##.#.##\n##.#.##############.#.##\n##...##########@.##...##\n###.###vvvvvvvv..###.###\n###.###..........###.###\n###.###........y.###.###\n########################\n########################`,`########################\n#......................#\n#......................#\n#....#....@.....#......#\n#....#..........#......#\n#....############......#\n#.....#.............y..#\n#.....#............##..#\n#.#####........#.......#\n#.#!...........#########\n#.#............#.......#\n#.#####........#.......#\n#.....#..n.y...######..#\n#.....#..###......!.#.##\n###...#.............####\n########################\n########################`,`########################\n#......................#\n#.y..................y.#\n#####..............#####\n#......................#\n#......................#\n#......................#\n#.........####.........#\n#.........#@.#.........#\n#.......!.#..#!........#\n#.........#..#.........#\n#.....#####..#####.....#\n#.....#..........#.....#\n#.....#....N.....#.....#\n###.+.#^^^####^^^#.+.###\n########################\n########################`,`########################\n#>....................<#\n#>....................<#\n#>.........@..........<#\n#>....................<#\n#>....................<#\n#>....................<#\n#>.........y..........<#\n########################\n#......................#\n#@.....................#\n#...+................g.#\n#####...............####\n#.#..................#.#\n#.#..................#.#\n#.#...=...=...=...=..#.#\n#.#..................#.#`,
        `########################\n#..................#####\n#.y.................####\n#####.....#..........###\n#####.....####........##\n##@..........#.........#\n##.....r.....#.........#\n##^^#######^^#.........#\n#####.....####.........#\n#......................#\n#......................#\n#.....###.......###....#\n#.....###.......###....#\n#.....##>.....@.<##....#\n#.+..###>...r...<##....#\n###################....#\n###################....#`,`########################\n#vvvvvv#...@....#vvvvvv#\n#......#.#....#.#......#\n#......#.u....u.#......#\n#......#........#......#\n#......#........#......#\n#......#........#......#\n#.....##........##.....#\n#......................#\n#......................#\n###..................###\n#+....................+#\n#......................#\n#^^^^^^^^^^^^^^^^^^^^^^#\n########################\n########################\n########################`,`########################\n#....@.#...............#\n#......#...............#\n#..#####............#..#\n#..#...#............#..#\n#..#.+.#.......######..#\n#..#...#..........u.#..#\n#..#...#............#..#\n#..#............#...#..#\n#..#.r..........#...#..#\n#..######.......#.+.#..#\n#..#............#...#..#\n#..#............#####..#\n#...............#@.....#\n#...............#......#\n########################\n########################`,`########################\n#......................#\n#......................#\n#...............#......#\n#............g..#......#\n#@.#...##########......#\n#..#...................#\n#N.#...................#\n############...........#\n#..vvvvvvvv#...........#\n#@.........#.........!.#\n#......n..+#....#......#\n########################\n#.#.#.#.#.#.#.#.#.#.#.##\n#.#.#.#.#.#.#.#.#.#.#.##\n########################\n########################`,`########################\n#......................#\n#......................#\n#.....####..####.......#\n#.....vv+....+vv.......#\n#......................#\n#.........##...........#\n#......................#\n#......................#\n#.....####..####.......#\n#.....vv+....+vv....####\n#...................#vv#\n#.........##........#@.#\n#...!.....uu....!...#..#\n#...................#N.#\n########################\n########################`,`########################\n#...vvvvvvvvvvvvvvvv.@.#\n#.n....................#\n####...................#\n#.u..................+.#\n#...^^^^^^^^^^^^^^^^...#\n########################\n#>.........@..........<#\n#>.........Y..........<#\n########################\n#...vvvvvvvvvvvvvvvv...#\n#.+..................n.#\n#...................####\n#@...................u.#\n#...^^^^^^^^^^^^^^^^...#\n########################\n########################`,
        `########################\n#####......++......#####\n####................####\n###..................###\n##....................##\n#......................#\n#......................#\n#......................#\n#......................#\n#..........##..........#\n#....................@.#\n#......................#\n#...............########\n#.....................+#\n#..n....s..............#\n########################\n########################`,`########################\n##@......####......#####\n##........!.........####\n##...................###\n##....................##\n#......................#\n#......................#\n#......................#\n#############..........#\n#..#........######.....#\n#..#...................#\n####...................#\n#...................##.#\n#......................#\n#..nS.s................#\n########################\n########################`,`########################\n#...........#..........#\n#...........#..........#\n#...........#..........#\n#...........#..........#\n#...........#..........#\n#.....#.....#.....#....#\n#.....#.....#.....#....#\n#.....#.....#.....#....#\n#.....#.....#.....#....#\n#.....#...........#....#\n#.....#...........#....#\n#.....#...........#....#\n#.....#...........#.@..#\n#..w..#...........#....#\n########################\n########################`,`########################\n#.u..#~~#~~~#~~~~~~~~~~#\n#....#~~#~~~#~~~~~~~~~~#\n#.......#~~~#~~~~~~~~~~#\n#...........#~~~~~~~~~~#\n#......................#\n#..n...................#\n####.................@.#\n####...................#\n#..u...................#\n#......................#\n#...........#~~~~~~~~~~#\n#.......#~~~#~~~~~~~~~~#\n#....#~~#~~~#~~~~~~~~~~#\n#.n..#~~#~~~#~~~~~~~~~~#\n########################\n########################`,`########################\n#...0...#+.1...#+++++++#\n#.......#####..#+++++++#\n#.......#......#+++++++#\n#.......#@.....#.......#\n#...#...#..S...#.......#\n#1#4#3#2###><#.#.......#\n###########><#.#......n#\n#.....#3########2.....##\n#.+.s.#.####4..#########\n#.###.#.######.#vvvvvvv#\n#.......######.#.......#\n#.....@.######.#.......#\n#.......#@.###.#.......#\n#..n..###...+..#N.....0#\n##################...###\n##################...###`,`########################\n####################...#\n##..###############....#\n#....##...####........+#\n#....#.....##........@.#\n#....#.....#....^......#\n#.......^..#...^########\n#...Y..<#>....<#v....@.#\n#....##########v....+..#\n#.....vvvvvvvvv...^#####\n#...N............<##...#\n#....#...........<##y#.#\n#....#################.#\n#....#vvvvvvvvvvv!.#>@.#\n##.g...............#>..#\n########################\n########################`,
        `########################\n#########y.#..#..#..####\n###yyyy##y.#..#y.#y.#G<#\n###yyyy##y.#..#y.#y.#.##\n###yyyy###.##.##.##.#..#\n##0yyyy###.##.##.##.##.#\n##.###..#..#..#..#..#..#\n##.0###.#.##.##.##.##.##\n##..##..4..5..6..7....^#\n##..##.#4##5##6##7######\n##..##3#g##g##.##.##>3<#\n##..####g##g##g##g##>.<#\n##..#12#1##2##1##2##^.^#\n##@.#@.##############+##\n##..#..#..#..#..#..#^1^#\n########################\n########################`,`########################\n#......................#\n#...@..................#\n#......................#\n#......................#\n#..9...............9...#\n#..8..............8....#\n#..7.............7.....#\n#..6............6......#\n#..5...........5.......#\n#..4..........4........#\n#..3.........3.........#\n#..2........2..........#\n#..1.......1...........#\n#n.0......0............#\n########################`,`####\n#n.#\n#..#\n#..#\n#@.#\n#..#\n####`,`####\n#r.#\n#..#\n#..#\n#@.#\n#..#\n####`,`####\n#y.#\n#..#\n#..#\n#@.#\n#..#\n####`,`####\n#g.#\n#..#\n#..#\n#@.#\n#..#\n####`,`####\n#s.#\n#..#\n#..#\n#@.#\n#..#\n####`,`####\n#@.#\n#..#\n#..#\n#..#\n#u.#\n####`,`####\n#nn#\n#..#\n#..#\n#@.#\n#..#\n#..#\n#..#\n#uu#\n####`];
    const END_LEVEL = `########################\n#......................#\n#......................#\n#......................#\n########################\n###.u..u..u..u..u..u.###\n#+....................+#\n#......................#\n#+...##...#..#...##...+#\n#....@....#@.#...@.....#\n#.........#..#.........#\n#+...##...#..#...##...+#\n#......................#\n#+....................+#\n###.n..n..n..n..n..n.###\n########################\n########################`;
    const MENU_LEVEL = `########################\n#......................#\n#......................#\n#......................#\n#......................#\n#......................#\n#......................#\n#......................#\n#......................#\n#......................#\n#......................#\n#......................#\n#......................#\n#......................#\n#......................#\n#......................#\n########################`;

    const playerXSpeed=7,gravity=40,jumpSpeed=17,bounceSpeed=18,keyFlashInterval=.5,endTime=.15,fadeTime=.5,scale=20,menuWidth=6,menuScale=68,menuItemSize=53,menuBorderWidth=4,keyDelay=.2,rotateSpeed=1.75,arrowKeys=trackKeys(['ArrowLeft','ArrowRight','ArrowUp','ArrowDown','r','b','Escape',' ','Enter']);
    function trackKeys(e){let t=Object.create(null);function s(s){e.includes(s.key)&&(t[s.key]='keydown'===s.type,s.preventDefault())}return window.addEventListener('keydown',s),window.addEventListener('keyup',s),trackKeys.unregister=()=>{window.removeEventListener('keydown',s),window.removeEventListener('keyup',s)},t}function runAnimation(e){let t=null;requestAnimationFrame((function s(r){if(null!=t){let s=Math.min(r-t,50)/1e3;if(!1===e(s))return}t=r,requestAnimationFrame(s)}))}function fade(e,t){let s=0,r=elt('div',{class:'fade-overlay'});return r.style.opacity=t?0:1,e.appendChild(r),new Promise((e=>{runAnimation((i=>(s+=i,s>fadeTime?(r.remove(),e('done'),!1):(r.style.opacity=t?s/fadeTime:1-s/fadeTime,!0))))}))}async function runLevel(e,t,s,r){let i=new r(s,e,t),l=State.start(e),a=0;l=l.update(0,arrowKeys),i.syncState(l,a),await fade(s,!1);let n=await new Promise((e=>{runAnimation((t=>(l.status.includes('playing')&&(l=l.update(t,arrowKeys),i.syncState(l,a)),arrowKeys.r?(e('lost'),!1):arrowKeys.b||arrowKeys.Escape?(e('break'),!1):!!l.status.includes('playing')||(a<endTime?(a+=t,i.syncState(l,a,l.dead||{}),!0):(e(l.status),!1)))))}));return await fade(s,!0),i.clear(),n}
    async function runMenu(e,t,s,r,i){let l=new i(t,new Level(MENU_LEVEL),s,r,e.length,!0),a=MenuState.start(e.length,s);a=a.update(0,arrowKeys,r),l.syncMenuState(a,arrowKeys),await fade(t,!1);let n=await new Promise((e=>{runAnimation((t=>(a=a.update(t,arrowKeys,r),l.syncMenuState(a,arrowKeys),!!a.status.includes('choosing')||(e(a.level),!1))))}));return await fade(t,!0),l.clear(),n}async function runGame(e,t,s){let r=e.length,i=[...'111'.padEnd(r,'1').slice(0,r)],l=elt('div',{class:'wrapper'});t.appendChild(l);let a=0;for(;;){for(a=await runMenu(e,l,a,i,s);a<e.length;){let t=await runLevel(new Level(e[a]),a,l,s);i=i.slice(),t=t.trim(),'won'===t?(i[a]=2,i[a+1]=Math.max(1,i[a+1]),a++):'break'===t&&(a=await runMenu(e,l,a,i,s))}a--;let t,r=new Level(END_LEVEL),n=elt('p',{class:'end',style:`line-height: 20px;font-size: 40px;width: ${20*r.width}px;`},'Thanks for Playing');l.appendChild(n);do{t=await runLevel(r,null,l,s)}while('won'!==t&&'break'!==t);n.remove()}}function elt(e,t,...s){let r=document.createElement(e);for(let e of Object.keys(t))r.setAttribute(e,t[e]);for(let e of s)'string'==typeof e?r.appendChild(document.createTextNode(e)):r.appendChild(e);return r}function notWall(e,t,s){return['empty','lava','spike'].includes(e.rows[s]?.[t])||''}
    function createGrid(e){return elt('table',{class:'background',style:`width: ${20*e.width}px;`},...e.rows.map(((t,s)=>elt('tr',{style:'height: 20px;'},...t.map(((t,r)=>elt('td',{class:`${t}${(notWall(e,r,s-1)&&' top')+(notWall(e,r,s+1)&&' bottom')+(notWall(e,r-1,s)&&' left')+(notWall(e,r+1,s)&&' right')}`,'data-number':1&(r^s)})))))))}function createActors(e){return elt('div',{},...e.map((e=>{let t=elt('div',{class:`actor ${e.type}`}),s=e.displaySize||e.size,r=e.displayPositionOffset?e.pos.add(e.displayPositionOffset):e.pos;return t.style.width=20*s.x+'px',t.style.height=20*s.y+'px',t.style.left=20*r.x+'px',t.style.top=20*r.y+'px',t.style.setProperty('--w',20*s.x+'px'),e.angle&&(t.style.transform=`rotate(${e.angle}rad)`),t})))}function createMenuBlocks(e,t,s,r,i){let l=(20*s-68*Math.min(6,e))/4;return new Array(e).fill(void 0).map(((e,s)=>elt('div',{class:'menu-item '+(s===t?'selected':''),style:`left: ${s%6*68+l}px;top: ${68*Math.floor(s/6)+20}px;border-width: 4px;width: 53px;height: 53px;line-height: 53px;font-size: ${53*.55}px;`,'data-status':i[s]},String(s+1))))}function overlapX(e,t,s,r){return e.x+t.x>s.x&&e.x<s.x+r.x}function overlapY(e,t,s,r){return e.y+t.y>s.y&&e.y<s.y+r.y}
    function actorOverlap(e,t){return overlapX(e.pos,e.size,t.pos,t.size)&&overlapY(e.pos,e.size,t.pos,t.size)}function overlap(e,t,s,r){return overlapX(e,t,s,r)&&overlapY(e,t,s,r)}function collidePos1D(e,t,s,r,i){let l=e-t,a=s-r,n=Math.abs(r-t-i)/(Math.abs(l)+Math.abs(a));return[t+l*n,r+a*n]}function collidePos(e,t,s,r,i){let[l,a]=collidePos1D(e.x,t.x,s.x,r.x,i.x),[n,o]=collidePos1D(e.y,t.y,s.y,r.y,i.y);return console.log(e,t,s,r,i),[new Vec(l,n),new Vec(l,n)]}
    class Vec{constructor(e,t){this.x=e,this.y=t}add(e){return new Vec(this.x+e.x,this.y+e.y)}sub(e){return new Vec(this.x-e.x,this.y-e.y)}mult(e){return new Vec(this.x*e,this.y*e)}div(e){return new Vec(this.x/e,this.y/e)}toString(){return`Vec [${this.x}, ${this.y}]`}}
    class DOMDisplay{constructor(e,t,s,r,i,l){if(l){t.width,t.height;this.menuBlocks=createMenuBlocks(i,s,t.width,t.height,r),this.menu=elt('div',{class:'menu',style:`width: ${20*(t.width-2)}px;height: ${20*(t.height-2)}px;padding: 20px;`},elt('div',{class:'levels-wrapper',style:`height: ${68*Math.ceil(i/6)}px;`},...this.menuBlocks)),this.bgLevel=t,this.dom=elt('div',{class:'game'},createGrid(t),elt('p',{class:'menu-text',style:`font-size: 16px;left: 20px;top: ${20*(t.height-1.5)}px;`},'Based on ',elt('a',{href:'https://www.puzzleplayground.com/jumping_clones'},'https://www.puzzleplayground.com/jumping_clones')),this.menu),this.first=!0}else this.dom=elt('div',{class:'game',style:`width: ${20*t.width}px;height: ${20*t.height}px;`},createGrid(t),elt('p',{class:'level-text',style:'font-size: 16px;right: 2px;top: -16px;'},null===s?'':`Level ${s+1}`)),this.actorLayer=null;e.appendChild(this.dom)}clear(){this.dom.remove()}
        syncState(e,t,s){if(this.actorLayer&&this.actorLayer.remove(),this.dots&&this.dots.remove(),this.actorLayer=createActors(e.actors.filter((e=>e!==s))),this.dom.appendChild(this.actorLayer),this.dom.className=`game ${e.status}`,e.status.includes('lost')&&0!==t&&(this.dom.style.transform=`translate(${4*Math.cos(t*Math.PI*40)}px, ${4*Math.sin(t*Math.PI*40)}px)`,s.pos)){let e=12;this.dots=elt('div',{class:'explode-wrapper'},...new Array(e).fill(null).map(((r,i)=>elt('div',{class:'explode-dot',style:`left: ${20*(s.pos.x+s.size.x/2)}px;top: ${20*(s.pos.y+s.size.y/2)}px;width: 5px;height: 5px;opacity: ${1.03-t/endTime};transform: translate(-50%, -50%)rotate(${i*Math.PI*2/e}rad)translateX(${300*t}px);`})))),this.dom.appendChild(this.dots)}}syncMenuState(e,t){let s=this.menuBlocks.findIndex((e=>e.className.includes('selected'))),r=this.menuBlocks[s];r.className=r.className.replace('selected',''),this.menuBlocks[e.level].className+=' selected',(s!=e.level||t.ArrowUp||t.ArrowDown||t.ArrowLeft||t.ArrowRight||this.first)&&(this.first=!1,68*Math.floor(e.level/6)-this.menu.scrollTop<0?this.menu.scrollTop=68*Math.floor(e.level/6+1)-53:68*Math.floor(e.level/6)+8+53-this.menu.scrollTop>20*(this.bgLevel.height-3)&&(this.menu.scrollTop=68*Math.floor(e.level/6)-20*(this.bgLevel.height-3)+8+53))}}
    class MenuState{constructor(e,t,s,r){this.numLevels=e,this.level=t,this.status=s,this.last=r}update(e,t,s){let r=this.level,i=this.status,l=this.last;if(l<=0){let e=!1;t.ArrowLeft&&(r--,e=!0),t.ArrowRight&&(r++,e=!0),t.ArrowUp&&(r-=6,e=!0),t.ArrowDown&&(r+=6,e=!0),e&&r>=0&&r<this.numLevels&&0!=s[r]?l=.2:r=this.level}else l-=e,t.ArrowLeft||t.ArrowRight||t.ArrowUp||t.ArrowDown||(l=0);return(t[' ']||t.Enter)&&(i='chosen'),new MenuState(this.numLevels,r,i,l)}static start(e,t){return new MenuState(e,t,'choosing',0)}}
    class Trampoline{constructor(e,t){this.pos=e,this.bounced=t}static create(e){return new Trampoline(e,!1)}get type(){return'trampoline'+(this.bounced?' bounce':'')}collide(e,t){e.actors.slice();let s,r=!1;return t.prevPos.y+t.size.y>=this.pos.y?s=t.prevPos.y>=this.pos.y+this.size.y?new Vec(t.speed.x,0):t.speed:(s=new Vec(t.speed.x,-18),r=!0),e=e.replaceActor(t,t.backout(this).set('speed',s)),r&&(e=e.replaceActor(this,new Trampoline(this.pos,!0))),e}update(){return new Trampoline(this.pos,!1)}}Trampoline.prototype.size=new Vec(1,1);
    class Key{constructor(e,t,s){this.pos=e,this.angle=t,this.flash=s%1}get type(){return'key'+(this.flash<.5?'':' flash')}static create(e){return new Key(e,0,0)}collide(e){let t=this,s=e.actors.filter((e=>e!==t)),r=e.status;return s.some((e=>e.type.includes('key')))||(r=r.replace(/ ?locked/,'')),new State(e.level,s,r,e.dead)}update(e){return new Key(this.pos,this.angle+1.75*e,this.flash+e)}}Key.prototype.size=new Vec(1,1),Key.prototype.displayPositionOffset=new Vec((1-1/Math.SQRT2)/2,(1-1/Math.SQRT2)/2),Key.prototype.displaySize=new Vec(1/Math.SQRT2,1/Math.SQRT2);
    class Spike{constructor(e,t,s){this.pos=e,this.size=t,this.dir=s}get type(){return`spike ${this.dir}`}static create(e,t){return'^'===t?new Spike(e.add(new Vec(0,.5)),new Vec(1,.5),'up'):'v'===t?new Spike(e,new Vec(1,.5),'down'):'<'===t?new Spike(e.add(new Vec(.5,0)),new Vec(.5,1),'left'):'>'===t?new Spike(e,new Vec(.5,1),'right'):void 0}collide(e,t){return new State(e.level,e.actors,e.status.replace('playing','lost'),t)}update(){return new Spike(this.pos,this.size,this.dir)}}
    class Teleporter{constructor(e,t,s=null,r=null){this.pos=e,this.num=t,this.ported=s,this.newPorted=r}get type(){return`teleporter ${this.num}`}static create(e,t){return new Teleporter(e,Number(t))}collide(e,t){let s=this,r=e.actors.find((e=>e.type===s.type&&e!==s));return this.ported===t.sig||this.newPorted===t.sig?e=e.replaceActor(this,this.setNewPorted(t.sig)):r.ported||r.newPorted||(e=(e=e.replaceActor(t,t.set('pos',r.pos))).replaceActor(r,r.setNewPorted(t.sig))),e}setNewPorted(e){return new Teleporter(this.pos,this.num,this.ported,e)}update(e){return new Teleporter(this.pos,this.num,this.newPorted)}}Teleporter.prototype.size=new Vec(1,1);
    class Portal{constructor(e,t,s){this.pos=e,this.passNum=t,this.counter=s,this.angle=s%(2*Math.PI);let r=Portal.prototype.size,i=Math.abs(s%(Math.PI/2)-Math.PI/4),l=Math.abs(Math.sin(i+Math.PI/4));this.displaySize=new Vec(r.x*l,r.y*l),this.displayPositionOffset=new Vec((2-this.displaySize.x)/4,(2-this.displaySize.y)/4)}get type(){return`portal ${this.passNum}`}static create(e,t){return'@'===t?new Portal(e,1/0,0):'!'===t?new Portal(e,1,0):void 0}collide(e,t){if(e.status.includes('locked')&&this.passNum===1/0)return e;let s=e.actors;this.passNum>1?s=(e=e.replaceActor(this,new Portal(this.pos,this.passNum-1,this.angle))).actors.filter((e=>e!=t)):this.passNum>0&&(s=e.actors.filter((e=>e!=this&&e!=t)));let r=e.status;return s.some((e=>e.type.includes('player')))||(r=r.replace('playing','won')),new State(e.level,s,r,e.dead)}update(e){return new Portal(this.pos,this.passNum,this.counter+1.75*e)}}Portal.prototype.size=new Vec(2,2);
    class Player{constructor(e,t,s,r,i,l,a,n='',o){this.pos=e,this.speed=t,this.jumpSpeed=s,this.xSpeed=r,this.gravity=i,this.toggle=l,this.sig=a,this.dir=n,this.prevPos=o||e}get type(){return`player ${this.sig.char} ${this.dir}`}static create(e,t){let s=Player.prototype.size;return e=e.add(new Vec((1-s.x)/2,1-s.y)),t!==t.toLowerCase()&&(e=e.add(new Vec(.5,0)),t=t.toLowerCase()),'n'===t?new Player(e,new Vec(null,0),17,7,40,1,{char:t}):'r'===t?new Player(e,new Vec(null,0),17,-7,40,1,{char:t}):'y'===t?new Player(e,new Vec(0,0),17,7,40,1,{char:t}):'g'===t?new Player(e,new Vec(null,0),0,7,40,1,{char:t}):'u'===t?new Player(e,new Vec(null,0),-17,7,-40,1,{char:t}):'s'===t?new Player(e,new Vec(null,0),17,0,40,1,{char:t}):'w'===t?new Player(e,new Vec(null,0),17,7,40,-1,{char:t}):void 0}update(e,t,s){let r=0;s.ArrowLeft&&(r-=this.xSpeed),s.ArrowRight&&(r+=this.xSpeed),this.speed.x&&!r&&(r=this.speed.x);let i=this.pos,l=i.add(new Vec(r*e,0)),a=t.level.touches(l,this.size,'wall');i=a?new Vec(r<0?a.pos.x+a.size.x:a.pos.x-this.size.x,i.y):l;let n=this.jumpSpeed,o=this.gravity,p=this.speed.y+e*this.gravity,h=i.add(new Vec(0,p*e));
            a=t.level.touches(h,this.size,'wall'),a?s.ArrowUp&&p>0^this.gravity<0?(i=new Vec(i.x,p>0?a.pos.y-this.size.y:a.pos.y+a.size.y),p=-this.jumpSpeed*this.toggle,n*=this.toggle,o*=this.toggle):(i=new Vec(i.x,p>0?a.pos.y-this.size.y:a.pos.y+a.size.y),p=0):i=h;let c=r>0?'right':r<0?'left':'',u=p>0?'down':p<0?'up':'';return this.fromNewPos(i,r,p,c,u,n,o)}fromNewPos(e,t,s,r,i,l=this.jumpSpeed,a=this.gravity){let n='string'==typeof i?`${r} ${i}`:this.dir,o=new Vec('number'==typeof this.speed.x?t:null,s);return new Player(e,o,l,this.xSpeed,a,this.toggle,this.sig,n,this.pos)}collide(e,t){let s=t.prevPos.sub(this.prevPos),r=t.pos.sub(this.pos),i=s.x<0?t.size.x:s.x>0?-this.size.x:0,l=s.y<0?t.size.y:s.y>0?-this.size.y:0,a=new Vec(i,l),n=r.add(a).mult(.5);return e=(e=e.replaceActor(this,this.set('pos',this.pos.add(n)))).replaceActor(t,t.set('pos',t.pos.add(n.mult(-1))))}
        backout(e,t=Object.create(null)){let s=e.prevPos||e.pos,r=this.prevPos,i=this.pos.x-r.x;this.speed.x&&!i&&(i=this.speed.x);let l=new Vec(this.pos.x,r.y);r=overlap(l,this.size,s,e.size)?new Vec(i<0?e.pos.x+e.size.x:e.pos.x-this.size.x,r.y):l;let a=this.pos.y-r.y,n=new Vec(r.x,this.pos.y);return overlap(n,this.size,s,e.size)?t.ArrowUp&&a>0^this.gravity<0&&e.type.includes('player')?a=-this.jumpSpeed:(r=new Vec(r.x,a>0?e.pos.y-this.size.y:e.pos.y+e.size.y),a=0):r=n,this.fromNewPos(r,i,a)}set(e,t){let s=new Player(this.pos,this.speed,this.jumpSpeed,this.xSpeed,this.gravity,this.toggle,this.sig,this.dir,this.prevPos);return s[e]=t,s}}Player.prototype.size=new Vec(.95,.95);
    const levelChars={'^':Spike,v:Spike,'<':Spike,'>':Spike,'.':'empty','#':'wall','~':'lava','=':Trampoline,'+':Key,'@':Portal,'!':Portal,n:Player,N:Player,g:Player,G:Player,y:Player,Y:Player,r:Player,R:Player,u:Player,U:Player,s:Player,S:Player,w:Player,W:Player,0:Teleporter,1:Teleporter,2:Teleporter,3:Teleporter,4:Teleporter,5:Teleporter,6:Teleporter,7:Teleporter,8:Teleporter,9:Teleporter};
    class Level{constructor(e){let t=e.trim().split('\n').map((e=>[...e]));this.height=t.length,this.width=t[0].length,this.startActors=[],this.rows=t.map(((e,t)=>e.map(((e,s)=>{let r=levelChars[e];return'string'==typeof r?r:(this.startActors.push(r.create(new Vec(s,t),e)),'empty')}))))}touches(e,t,s){let r=Math.floor(e.x),i=Math.ceil(e.x+t.x),l=Math.floor(e.y),a=Math.ceil(e.y+t.y);for(let e=l;e<a;e++)for(let t=r;t<i;t++){if((t<0||t>=this.width||e<0||e>=this.height?'lava':this.rows[e][t])===s)return{pos:new Vec(t,e),size:new Vec(1,1)}}return!1}}
    class State{constructor(e,t,s,r){this.level=e,this.actors=t,this.status=s,this.dead=r}static start(e){let t=e.startActors.some((e=>e.type.includes('key')));return new State(e,e.startActors,'playing '+(t?' locked':''),null)}get players(){return this.actors.filter((e=>e.type.includes('player')))}get numPlayers(){return this.actors.reduce(((e,t)=>t.type.includes('player')?e+1:e),0)}hits(e,t,s){for(let r of this.actors)if(r.type.includes(s)&&overlap(e,t,r.pos,r.size))return r;return!1}replaceActor(e,t){let s=this.actors.slice();return s[s.indexOf(e)]=t,new State(this.level,s,this.status,this.dead)}update(e,t){let s=this.actors.map((s=>s.update(e,this,t))),r=new State(this.level,s,this.status,this.dead);if(!r.status.includes('playing'))return r;let i=!1,l=0;do{let e=r.players;i=!1,l++;for(let t=0,i=e.length;t<i;t++){let i=e[t];if(this.level.touches(i.pos,i.size,'lava'))return new State(this.level,s,r.status.replace('playing','lost'),i)}for(let t=e.length;t-- >0;){let e=r.numPlayers;for(let s=r.actors.length;s-- >0;){let i=r.actors[s];if(e!==r.numPlayers)break;let l=r.players[t];i!==l&&actorOverlap(i,l)&&(r=i.collide(r,l))}}}while(i&&l<400);return r}}
    
    runGame(GAME_LEVELS, document.body, DOMDisplay);
    ">Load</button>
</body>

</html>